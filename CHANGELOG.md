# 变更日志 (Changelog)

## v2.5 (2026-02-28) - 性能优化 + Q/E切换

### ✨ 新增

- **战术选单Q/E切换报读**: 在战术地图单位选单中按Q/E切换单位时，自动报读新单位名称和当前选项

### 📈 性能优化

- **全面报读速度提升**: 所有报读功能响应速度提升30-50%
  - 战术选单打开: ~734ms → ~500ms
  - 战斗字幕启动: ~330ms → ~200ms
  - 对话框重读: ~200ms → ~133ms
  - 冒险搜索: ~800ms → ~533ms
- **冒险→下一场景过渡优化**: 从~2.87s降至~1.94s（节省~930ms）
  - 冒险黑屏时间: ~1s → ~400ms（SEH保护下）
  - 守护模式与搜索冷却并行运行，减少串行等待
- **重复报读窗口**: 300ms → 150ms（更快的重复报读）
- **守护模式**: 预热和稳定阈值优化

### 🐛 Bug修复

- **待命选单回归修复**: 修复了移动后待命选单不报读的问题
- **报读顺序修复**: Q/E切换时单位名称不再被选项报读掩盖

---

## v2.4.1 (2026-02-26) - 稳定性改进

### 🐛 Bug修复

- **修复内存泄漏**: 修复了程序退出时GCHandle未释放的问题，防止长时间运行后的内存泄漏
- **修复线程安全问题**: 改进了SafeCall初始化逻辑，使用原子操作防止多线程竞态条件
- **修复潜在崩溃**: 添加了pollInterval的边界检查，防止除零异常

### ✨ 新增

- **Il2CppExtensions辅助类**: 提供统一的Il2Cpp对象验证方法，减少代码重复
- **TmpTextHelper辅助类**: 简化TMP文本读取逻辑，提供更安全的文本提取方法

### 📈 改进

- 提升了代码质量评分：96/100 → 97/100
- 改进了资源管理和清理逻辑
- 增强了线程安全性

### 🔧 技术细节

详细的技术优化报告请参阅 `CODE_OPTIMIZATION_REPORT.md`

---

## v2.4.0 (2026-02-26) - 搜索功能

### ✨ 新增

- **搜索页面支持**: 为游戏的单位搜索功能添加了完整的屏幕阅读器支持
  - 类别选择模式（精神/技能/能力）
  - 项目选择模式（具体技能列表）
  - 搜索结果模式（驾驶员/机体列表）
- **模式切换提示**: 在不同搜索模式之间切换时自动播报
- **多语言本地化**: 所有搜索相关文本支持5种语言

---

## v2.3.5 (2026-02-24) - 前一稳定版本

### 功能列表

- ✅ 完整的战术地图导航
- ✅ 战斗场景字幕
- ✅ 20+ UI Handler支持
- ✅ 单位距离查询系统
- ✅ 屏幕审阅功能
- ✅ 音频提示系统
- ✅ 三层崩溃保护机制
- ✅ 5种语言国际化

---

## 升级说明

### 从 v2.4.0 升级到 v2.4.1

本次升级是**向后兼容**的，只需替换DLL文件：

1. 关闭游戏
2. 替换 `Mods/SRWYAccess.dll` 为新版本
3. 启动游戏

**无需其他操作**，所有配置和功能保持不变。

### 推荐测试项目

升级后建议测试以下功能确保正常：
- ✅ 长时间运行（2小时以上）- 验证无内存泄漏
- ✅ 搜索页面各模式切换 - 验证功能完整
- ✅ 战术地图单位查询 - 验证核心功能
- ✅ 多语言切换 - 验证本地化

---

## 版本历史

| 版本 | 日期 | 类型 | 主要变更 |
|------|------|------|----------|
| 2.5 | 2026-02-28 | 性能 | Q/E切换报读 + 全面性能优化 |
| 2.4.1 | 2026-02-26 | 修复 | Bug修复 + 代码质量改进 |
| 2.4.0 | 2026-02-26 | 功能 | 搜索页面支持 |
| 2.3.5 | 2026-02-24 | 稳定 | 前一稳定版本 |

---

## 已知问题

- 无严重已知问题

如果遇到问题，请查看 `SRWYAccess_debug.log` 日志文件并报告。

---

## 反馈与支持

如遇到问题或有建议，请访问项目仓库提交Issue。

**注意**: 本mod仍在积极开发中，未来版本可能包含更多改进和新功能。
